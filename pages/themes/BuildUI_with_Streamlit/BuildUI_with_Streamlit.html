<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>BuildUI_with_Streamlit</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
    <link rel="shortcut icon" href="/ProgressBG-ChatGPT_and_ML-Slides/images/favicons/favicon-32.png">
    <!-- css & themes include -->
    <link rel="stylesheet" href="/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="/ProgressBG-ChatGPT_and_ML-Slides/outfit/css/themes/light.css" id="theme">
    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/css/print/pdf.css' : '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <!-- add MathJax support -->
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <base target="_blank">
</head>
<body>
    <div class="reveal default center" data-transition-speed="default" data-background-transition="default">
        <div class="top_links">
            <a class="home_link" href="/ProgressBG-ChatGPT_and_ML-Slides/pages/agenda/agenda.html#BuildUI_with_Streamlit" target="_top"><i class="fa fa-home"></i></a>
            <span class="help_link" href="#"><i class="fa fa-question"></i></span>
            <div class="help_text">
                <div class="note">Keyboard shortcuts:</div>
                <div><span>N/Space</span><span>Next Slide</span></div>
                <div><span>P</span><span>Previous Slide</span></div>
                <div><span>O</span><span>Slides Overview</span></div>
                <div><span>ctrl+left click</span><span>Zoom Element</span></div>
                <div class="print-howto"><br>If you want print version => add '<code>?print-pdf</code>' <br> at the end of slides URL (remove '#' fragment) and then print. <br>
                Like: https://ProgressBG-ChatGPT_and_ML-course.github.io/...CourseIntro.html?print-pdf </div>
            </div>
        </div>
        <div class="footer theme_switch">
            <a href="#" onclick="document.getElementById('theme').setAttribute('href','/ProgressBG-ChatGPT_and_ML-Slides/outfit/css/themes/dark.css'); return false;">Dark</a>
            <a href="#" onclick="document.getElementById('theme').setAttribute('href','/ProgressBG-ChatGPT_and_ML-Slides/outfit/css/themes/light.css'); return false;">Light</a>
            <a href="#" onclick="document.getElementById('theme').setAttribute('href','/ProgressBG-ChatGPT_and_ML-Slides/outfit/css/themes/projector.css'); return false;">Projector</a>
        </div>
        <div class="slides">
<!--
########################################################
##################### SLIDES START #####################
########################################################
-->
<section><h1>Build User Interface (UI) with Streamlit</h1></section>
<section data-transition="zoom">
    <!-- linkedin badge -->
    <!--<script type="text/javascript" src="https://platform.linkedin.com/badges/js/profile.js" async defer></script>-->
    <section class="copyright" data-transition="zoom">
        <div class="note">
            <p>Created for</p>
        </div>
        <div class="company">
            <a href="http://progressbg.net/Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¸Ñ€Ð°Ð½Ðµ-Ñ-python-2/">
            <img style="height:80%" src="/ProgressBG-ChatGPT_and_ML-Slides/outfit/images/logos/ProgressBG_logo_529_127.png">
            </a>
        </div>
        <div class="author">
            <span class="note">Iva E. Popova, 2023-2026,</span>
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
        </div>
    </section>
    <section class="copyright" data-transition="zoom" style="margin-top: -2em;">
        <div class="company">
             <div class="LI-profile-badge"  data-version="v1" data-size="large" data-locale="en_US" data-type="vertical" data-theme="dark" data-vanity="ivapopova"><a class="LI-simple-link" href='https://bg.linkedin.com/in/ivapopova?trk=profile-badge'>Iva E. Popova on LinkedIn</a></div>
        </div>
    </section>
</section>


<section class="main-sesction-title" id="Streamlit_Overview"><h1>Streamlit Overview</h1></section>
<section class="sub-sections"><h2>Streamlit Overview</h2>
    <section><h3>Streamlit Overview</h3>
        <dl class="fa" style="min-width:80vw">
            <dt>Streamlit is an open-source Python framework designed specifically for data scientists and AI engineers to build interactive web applications with zero web development experience.</dt>
            <dd>Instead of writing HTML, CSS, or JavaScript, you write standard Python scripts. Streamlit then "interprets" those scripts and automatically generates a modern, responsive frontend for you.</dd>
            <dt>Installation: <code>pip install streamlit</code></dt>
        </dl>
    </section>
    <section><h3>Key Features</h3>
        <dl class="fa" style="min-width:80vw">
            <dt><b>No frontend code required</b></dt>
            <dd>You create titles, sliders, buttons, and charts using simple commands like st.title() or st.button().</dd>
            <dt><b>Automatic hot-reloading</b></dt>
            <dd>As soon as you save your Python file, the web app in your browser updates instantly to show the changes.</dd>
            <dt><b>Built-in chat widgets</b></dt>
            <dd>It includes specialized components for AI, such as st.chat_input and st.chat_message, which are perfect for building ChatGPT-like interfaces.</dd>
            <dt><b>Easy data visualization</b></dt>
            <dd>It integrates seamlessly with libraries like Pandas, Plotly, and Matplotlib to display interactive tables and graphs.</dd>
        </dl>
    </section>
    <section><h3>How it Works (The "Mental Model")</h3>
        <dl class="fa" style="min-width:80vw">
            <dt>Streamlit has a unique execution model: The script runs from top to bottom every time a user interacts with a widget.</dt>
            <dd>1. The user moves a slider or types in a text box.</dd>
            <dd>2. Streamlit reruns the entire Python script.</dd>
            <dd>3. The UI updates to reflect the new state of your variables.</dd>
            <dt>To prevent slow AI models from reloading every time, Streamlit uses Caching (@st.cache_resource), which keeps the model in memory across these reruns.</dt>
        </dl>
    </section>
    <section><h3>Quick Command Comparison</h3>
        <table border="1" style="border-collapse: collapse; width: 100%; font-family: sans-serif;">
            <thead>
                <tr style="background-color: #f2f2f2; text-align: left;">
                <th style="padding: 10px; border: 1px solid #ddd;">Task</th>
                <th style="padding: 10px; border: 1px solid #ddd;">Python (Terminal)</th>
                <th style="padding: 10px; border: 1px solid #ddd;">Streamlit (Web UI)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Print Text</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>print("Hello")</code></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>st.write("Hello")</code></td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Get Input</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>name = input("Name?")</code></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>name = st.text_input("Name?")</code></td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Display Table</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>print(df)</code></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>st.dataframe(df)</code></td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Show Image</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><em>Requires external lib</em></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>st.image("pic.jpg")</code></td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Chat Context</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>messages.append(...)</code></td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>st.session_state.messages</code></td>
                </tr>
            </tbody>
            </table>
    </section>
    <section><h3>Run Streamlit Script</h3>
        <dl class="fa">
            <dt>Run the script using the command: <code>streamlit run script.py</code></dt>
            <dt>Streamlit will open a local web server and display your app in your default browser.</dt>
            <dt>Streamlit will automatically reload the app when you make changes to the script.</dt>
            <dt>Example:</dt>
            <dd>Let's have next app.py</dd>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                st.title("Simple Column Layout")
            </code></pre>
            <dd>Run it using: <code>streamlit run app.py</code></dd>
        </dl>
    </section>    
</section>

<section class="main-section-title"><h1>Common Streamlit Widgets</h1></section>
<section class="sub-sections"><h2>Common Streamlit Widgets</h2>
    <section><h3>Displaying Text and Media</h3>
        <dl class="fa">
            <dt style="width: 50vw;">Text Elements</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                st.title("My Streamlit App")
                st.header("Section Header")
                st.subheader("Subsection")
                st.text("Plain text")
                st.markdown("**Markdown** is _supported_")
            </code></pre>
            <dt style="width: 50vw;">Media Elements</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                st.image("https://via.placeholder.com/150")
                st.audio("https://via.placeholder.com/150")
                st.video("https://via.placeholder.com/150")
            </code></pre>
        </dl>
    </section>
    <section><h3>User Input Widgets</h3>
        <dl class="fa">
            <dt>User Input widgets are the core of Streamlit UIs. Each widget returns a value.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                name = st.text_input("Enter your name")
                age = st.number_input("Enter your age", min_value=0)
                choice = st.selectbox("Choose one", ["A", "B", "C"])
                slider = st.slider("Pick a value", 0, 100)
                checked = st.checkbox("I agree")
                button = st.button("Submit")
            </code></pre>
        </dl>
    </section>
    <section><h3>Chat Elements</h3>
        <dl class="fa">
            <dt>Chat elements are used to create a chat interface.</dt>
            <dt>More on their behavior will be discussed further.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                st.chat_input("Enter your message")
                st.chat_message("user").write("Hello")
                st.chat_message("assistant").write("Hello")
            </code></pre>
            <dt><code>st.chat_input</code> is automatically pinned to the bottom.</dt>
            <dt>Use <code>st.chat_message</code> to create a chat message.</dt>
        </dl>
    </section>
    <section><h3>User Input vs. Chat Elements</h3>
        <table border="1" style="border-collapse: collapse; width: 100%; font-family: sans-serif; font-size: 0.8em;">
            <thead>
                <tr style="background-color: #f2f2f2; text-align: left;">
                <th style="padding: 10px; border: 1px solid #ddd;">Feature</th>
                <th style="padding: 10px; border: 1px solid #ddd;">User Input (e.g., st.text_input)</th>
                <th style="padding: 10px; border: 1px solid #ddd;">Chat Elements (e.g., st.chat_input)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Placement</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Appears exactly where called in the code.</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>st.chat_input</code> is automatically pinned to the bottom.</td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Visual Style</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Standard form widgets (label + input).</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Designed to look like a chat app (bubbles, avatars).</td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Primary Use</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Forms, settings, data filtering.</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Conversational AI, messaging interfaces.</td>
                </tr>
                <tr>
                <td style="padding: 10px; border: 1px solid #ddd; font-weight: bold;">Interaction</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Returns its current state on every rerun.</td>
                <td style="padding: 10px; border: 1px solid #ddd;"><code>st.chat_input</code> returns value ONLY when the user presses Enter/Submit.</td>
                </tr>
            </tbody>
        </table>
    </section>
    <section><h3>Layout and Page Structure</h3>
        <dl class="fa">
            <dt><b>Columns</b></dt>
            <dd>Use these to place elements side-by-side (e.g., a chart next to a table). It divides the horizontal space into proportional segments.</dd>
            <dt><b>Containers</b></dt>
            <dd>Use containers to group related elements together. They can be nested and styled with borders or other attributes.</dd>
            <dt><b>Expander</b></dt>
            <dd>Use expanders to hide or show content. They are useful for showing additional details or for creating a collapsible section.</dd>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st
                
                with st.container(border=True):
                    st.write("Grouped content")
                    col1, col2 = st.columns(2)
                    with col1:
                        st.write("Left column")
                    with col2:
                        st.write("Right column")

                with st.expander("More details"):
                    st.write("Hidden details 1")
                    st.write("Hidden details 2")
            </code></pre>
        </dl>
    </section>
    <section><h3>Sidebar Navigation</h3>
        <dl class="fa">
            <dt>Streamlit provides a way to navigate between different pages in your app using the sidebar.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st
                
                st.sidebar.title("Navigation")
                page = st.sidebar.selectbox("Select a page", ["Home", "Page 1", "Page 2"])
                
                if page == "Home":
                    st.title("Home")
                elif page == "Page 1":
                    st.title("Page 1")
                elif page == "Page 2":
                    st.title("Page 2")
            </code></pre>
        </dl>
    </section>    
</section>
<section><h2>Displaying Data</h2>
    <section><h3>Tables and DataFrames</h3>
        <dl class="fa">
            <dt>Streamlit provides a way to display tables and dataframes in your app.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st
                import pandas as pd

                df = pd.DataFrame({"A": [1, 2], "B": [3, 4]})

                st.dataframe(df) # Interactive
                st.table(df) # Static
            </code></pre>
        </dl>
    </section>
    <section><h3>Charts</h3>
        <dl class="fa">
            <dt>Streamlit provides a way to display charts in your app.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st
                import pandas as pd

                df = pd.DataFrame({"A": [1, 2], "B": [3, 4]})

                st.line_chart(df)
                st.bar_chart(df)
            </code></pre>
        </dl>
    </section>
</section>
<section><h2>Forms and Grouped Input</h2>
    <section><h3>Forms</h3>
        <dl class="fa">
            <dt>Streamlit provides a way to group input widgets in a form.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                with st.form("my_form"):
                    st.write("Inside the form")
                    slider_val = st.slider("Form slider")
                    checkbox_val = st.checkbox("Form checkbox")
                    
                    # Every form must have a submit button.
                    submitted = st.form_submit_button("Submit")
                    if submitted:
                        st.write("slider", slider_val, "checkbox", checkbox_val)
            </code></pre>
        </dl>
    </section>
</section>


<section class="main-section-title"><h1>Understanding Session State</h1></section>
<section class="sub-sections"><h2>Understanding Session State</h2>
    <section><h3>The "Rerun" Problem</h3>
        <dl class="fa">
            <dt>Streamlit executes your script from top to bottom on every user interaction.</dt>
            <dd>This means that regular Python variables are <b>re-initialized</b> to their default values every time a button is clicked or a slider is moved.</dd>
            <dt>Example of the Problem:</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                count = 0
                if st.button("Increment"):
                    count += 1

                st.write(f"Count: {count}") # Will ALWAYS be 1 after click, then back to 0!
            </code></pre>
            <dt>The solution is to use Session State.</dt>            
        </dl>
    </section>
    <section><h3>What is Session State?</h3>
        <dl class="fa">
            <dt>Session State is a way to share variables between reruns, for each user session.</dt>
            <dd>Think of it as a <b>persistent dictionary</b> that Streamlit maintains for the duration of the user's connection.</dd>
            <dt>Key Characteristics:</dt>
            <dd>It is <b>Isolated</b>: Each user has their own independent state.</dd>
            <dd>It is <b>Persistent</b>: Data survives the "top-to-bottom" rerun of the script.</dd>
            <dd>It is <b>Dictionary-based</b>: You access variables using keys (e.g., <code>st.session_state["my_key"]</code>).</dd>
        </dl>
    </section>
    <section><h3>How to Use Session State</h3>
        <dl class="fa">
            <dt>1. Initialization</dt>
            <dd>Always check if a key exists before using it to avoid errors on the first run.</dd>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                if "count" not in st.session_state:
                    st.session_state.count = 0
            </code></pre>
            <dt>2. Updating and Reading</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                if st.button("Increment"):
                    st.session_state.count += 1

                st.write(f"Current Count: {st.session_state.count}")
            </code></pre>
        </dl>
    </section>
</section>


<section class="main-section-title"><h1>Chat Interface Elements</h1></section>
<section class="sub-sections"><h2>Display vs. Input</h2>
    <section><h3>The Chat Building Blocks</h3>
        <dl class="fa">
            <dt>Streamlit provides two distinct elements to build conversational apps:</dt>
            <dt><b>st.chat_input (The Input)</b></dt>
            <dd>A sticked to the bottom user input box.</dd>
            <dt><b>st.chat_message (The Output)</b></dt>
            <dd>A container that displays the conversation history.</dd>
        </dl>
    </section>

    <section><h3>1. The Input Widget (st.chat_input)</h3>
        <dl class="fa">
            <dt>The input widget is the interaction point. It is <b>pinned to the bottom</b>.</dt>
            <dd>It halts the script until the user presses Enter.</dd>
            <dt><b>Inline Processing</b>: Use the "walrus operator" (<code>:=</code>) to capture the input and act on it immediately.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
# The script stops here and waits for the user
if prompt := st.chat_input("Type your message here..."):
    st.write(f"Received: {prompt}")
            </code></pre>
        </dl>
    </section>

    <section><h3>2. The Output Container (st.chat_message)</h3>
        <dl class="fa">
            <dt>Once we have input, we need to display it nicely.</dt>
            <dt><code>st.chat_message</code> creates a container with a background color and an avatar.</dt>
            <dt><b>The "Role" Logic</b>: You must assign a role to every message.</dt>
            <dd><b>"user"</b>: Shows a person icon (User's messages).</dd>
            <dd><b>"assistant"</b>: Shows a robot icon (AI's responses).</dd>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st

                # Output user message
                with st.chat_message("user"):
                    st.write("Hello World")

                # Output assistant message
                with st.chat_message("assistant"):
                    st.write("Hello Human!")

            </code></pre>
        </dl>
    </section>

    <section><h3>Persistence & State</h3>
        <dl class="fa">
            <dt>Chat elements are <b>stateless</b> by default.</dt>
            <dd>When <code>st.chat_input</code> triggers a rerun, the old messages vanish.</dd>
            <dt><b>The Solution</b>: You must store the conversation in <code>st.session_state</code> and redraw it at the top of the script.</dt>            
        </dl>
    </section>

    <section><h3>Example: The Full Chat Loop</h3>
        <pre><code rel="Python" class="python" style="min-height: 1vh;">
            import streamlit as st
            import time
            import random

            st.title("ðŸ¤– Fake LLM Chat")

            # 1. Initialize history
            if "messages" not in st.session_state:
                st.session_state.messages = []

            # 2. Render history (Redraw previous messages)
            for msg in st.session_state.messages:
                st.chat_message(msg["role"]).write(msg["content"])

            # 3. Handle new input
            if prompt := st.chat_input("Say something..."):
                # A. Display User Message
                st.chat_message("user").write(prompt)
                st.session_state.messages.append({"role": "user", "content": prompt})

                # B. Generate & Display Assistant Response
                with st.chat_message("assistant"):
                    with st.spinner("Thinking..."):
                        time.sleep(1)  # Fake delay

                        # Simple fake logic to mimic intelligence
                        responses = [
                            f"That's interesting! You said: '{prompt}'. Tell me more.",
                            "I am just a simple script, but I agree."                
                        ]
                        response_text = random.choice(responses)

                        st.write(response_text)

                # C. Save Assistant Response to history
                st.session_state.messages.append({"role": "assistant", "content": response_text})
        </code></pre>
    </section>
</section>

<section class="main-section-title"><h1>Build Sentiment-Aware Chatbot UI with Streamlit</h1></section>
<section class="sub-sections"><h2>Build Sentiment-Aware Chatbot UI with Streamlit</h2>
    <section id="SentimentBot">
        <dl class="fa" style="min-width:80vw">
            <dt>To convert our Ollama + HuggingFace Hybrid Bot into a professional-looking web application, we will use Streamlit's chat elements.</dt>
            <dt>Note, that the script uses @st.cache_resource to ensure the 300MB sentiment model is only loaded into memory once, making the app much faster to use.</dt>
            <pre><code rel="Python" class="python" style="min-height: 1vh;">
                import streamlit as st
                import ollama
                from transformers import pipeline

                # --- 1. CONFIGURATION & SETUP ---
                st.set_page_config(page_title="Hybrid Sentiment Bot", layout="wide")
                LLM_MODEL = "phi3:latest"
                EMO_MODEL = "j-hartmann/emotion-english-distilroberta-base"

                # --- 2. HELPER FUNCTIONS (The Logic) ---

                @st.cache_resource
                def get_analyzer():
                    """Loads the emotion detection model once and caches it."""
                    return pipeline("text-classification", model=EMO_MODEL)

                def get_system_instruction(emotion):
                    """Returns the personality instructions based on emotion."""
                    # Define how the bot should behave for each emotion
                    behaviors = {
                        "anger":   "The user is ANGRY. Be calm, empathetic, and try to de-escalate.",
                        "joy":     "The user is HAPPY. Be energetic and share their excitement!",
                        "sadness": "The user is SAD. Be supportive, gentle, and very comforting.",
                        "default": "Be a helpful and professional AI assistant."
                    }
                    return behaviors.get(emotion, behaviors["default"])

                # --- 3. STATE & UI ---

                st.title("ðŸ¤– Emotional Support Bot")

                # Initialize Session State
                if "messages" not in st.session_state:
                    st.session_state.messages = []
                if "current_emotion" not in st.session_state:
                    st.session_state.current_emotion = "Neutral"

                # 1. Create an EMPTY slot in the sidebar at the top
                with st.sidebar:
                    st.header("Analytics")
                    # Give it a variable name so we can talk to it later
                    metric_placeholder = st.empty()

                    if st.button("Reset Chat"):
                        st.session_state.messages = []
                        st.rerun()

                # Draw Chat History
                for msg in st.session_state.messages:
                    st.chat_message(msg["role"]).write(msg["content"])

                # --- 4. MAIN CHAT LOOP ---

                if user_input := st.chat_input("How are you feeling?"):

                    # Step A: Show User Input
                    st.chat_message("user").write(user_input)
                    st.session_state.messages.append({"role": "user", "content": user_input})

                    # Step B: Analyze Emotion
                    analyzer = get_analyzer()
                    result = analyzer(user_input)[0]
                    emotion_label = result['label']

                    # Update the sidebar state immediately
                    metric_placeholder.metric("Detected Emotion", emotion_label.upper())

                    # Step C: Generate AI Response
                    system_prompt = get_system_instruction(emotion_label)

                    with st.chat_message("assistant"):
                        response_box = st.empty()
                        full_text = ""

                        # Connect to Ollama with the specific system prompt
                        stream = ollama.chat(
                            model=LLM_MODEL,
                            messages=[{"role": "system", "content": system_prompt}] + st.session_state.messages,
                            stream=True,
                        )

                        # Stream the text to the screen
                        for chunk in stream:
                            full_text += chunk['message']['content']
                            response_box.markdown(full_text + "â–Œ") # Adds a cursor effect

                        response_box.markdown(full_text)

                    # Step D: Save and Refresh
                    st.session_state.messages.append({"role": "assistant", "content": full_text})

            </code></pre>
        </dl>
    </section>
</section>

<!-- <section class="main-sesction-title" id="hw"><h1>Exercises</h1></section>
<section class="sub-sections"><h2>Task1</h2>
    <section><h3>The Task</h3>

    </section>
</section> -->

<!-- <section><h3>Submission</h3>
    <dl class="fa">
        <dt>Please, prefix your filenames/archive with your name initials, before sending.</dt>
        <dd>For instance: <b>iep_task1.py</b> or <b>iep_tasks.rar</b></dd>
        <dt>Send files to <a href="mailto:progressbg.python.course@gmail.com?Subject=HW: BuildUI_with_Streamlit">progressbg.python.course@gmail.com</a></dt>
    </dl>
</section> -->



<section class="disclaimer" data-background="/ProgressBG-ChatGPT_and_ML-Slides/outfit/images/for_slides/the_end_on_sand.jpg">
     <p>These slides are based on</p>
     <p>customised version of </p>
     <p><a href="http://hakim.se/">Hakimel</a>'s <a href="http://lab.hakim.se/reveal-js">reveal.js</a></p>
     <p>framework</p>
</section>
<!--
########################################################
##################### SLIDES END   #####################
########################################################
-->
        </div>
    </div>
    <!-- Custom processing -->
    <script src="/ProgressBG-ChatGPT_and_ML-Slides/outfit/js/slides.js"></script>
    <!-- external scripts -->
    <script src="/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/lib/js/head.min.js"></script>
    <script src="/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/js/reveal.js"></script>
     <!-- init reveal -->
    <script>
        // Full list of configuration options available at:
        // https://github.com/hakimel/reveal.js#configuration
        var highlightjsTabSize = '  ';
        Reveal.initialize({
            controls: true,
            progress: true,
            slideNumber: 'c/t',
            keyboard: true,
            history: true,
            center: true,
            width: 1920,
            height: 1280,
            // Bounds for smallest/largest possible scale to apply to content
            // minScale: .5,
            maxScale: 1,
            // slide transition
            transition: 'concave', // none/fade/slide/convex/concave/zoom
            // Factor of the display size that should remain empty around the content
            margin: 0.1,
            // shift+mouse click to zoom in/out element
            zoomKey: 'ctrl',
            // theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
            // transition: Reveal.getQueryHash().transition || 'default'
            // Optional reveal.js plugins
            dependencies: [
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.configure(); hljs.initHighlightingOnLoad(); } },
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/plugin/zoom-js/zoom.js', async: true },
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/plugin/notes/notes.js', async: true },
                { src: '/ProgressBG-ChatGPT_and_ML-Slides/lib/reveal.js/plugin/math/math.js', async: true }
            ]
        });
    </script>
</body>
</html>
